<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Rust and Bevy Engine: One-Button GameJam (Part Two)" /><meta property="og:locale" content="en" /><meta name="description" content="Given that we only had two weeks to complete this game jam, our groupâ€™s concept had to be simple to execute. After exploring various ideas, we ultimately chose a minigolf-style game that used only the mouse as our one button." /><meta property="og:description" content="Given that we only had two weeks to complete this game jam, our groupâ€™s concept had to be simple to execute. After exploring various ideas, we ultimately chose a minigolf-style game that used only the mouse as our one button." /><link rel="canonical" href="https://brooke.fyi/posts/one-button-jam-2/" /><meta property="og:url" content="https://brooke.fyi/posts/one-button-jam-2/" /><meta property="og:site_name" content="Brooke Rhodes" /><meta property="og:image" content="https://brooke.fyi/assets/img/post/one-button-jam-header.png" /><meta property="og:image:height" content="720" /><meta property="og:image:width" content="1280" /><meta property="og:image:alt" content="Screenshot of the final game. Not that pretty, but not bad for two weeks of work!" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-01-26T00:00:00+00:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://brooke.fyi/assets/img/post/one-button-jam-header.png" /><meta name="twitter:image:alt" content="Screenshot of the final game. Not that pretty, but not bad for two weeks of work!" /><meta property="twitter:title" content="Rust and Bevy Engine: One-Button GameJam (Part Two)" /><meta name="twitter:site" content="@grilme99" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-05-19T08:12:26+01:00","datePublished":"2023-01-26T00:00:00+00:00","description":"Given that we only had two weeks to complete this game jam, our groupâ€™s concept had to be simple to execute. After exploring various ideas, we ultimately chose a minigolf-style game that used only the mouse as our one button.","headline":"Rust and Bevy Engine: One-Button GameJam (Part Two)","image":{"width":1280,"height":720,"alt":"Screenshot of the final game. Not that pretty, but not bad for two weeks of work!","url":"https://brooke.fyi/assets/img/post/one-button-jam-header.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://brooke.fyi/posts/one-button-jam-2/"},"url":"https://brooke.fyi/posts/one-button-jam-2/"}</script><title>Rust and Bevy Engine: One-Button GameJam (Part Two) | Brooke Rhodes</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Brooke Rhodes"><meta name="application-name" content="Brooke Rhodes"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/img/avatar.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">Brooke Rhodes</a></div><div class="site-subtitle fst-italic">Software Engineer working on games, systems, and tools.</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/grilme99" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/grilme99" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['brooke','gril.me'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Rust and Bevy Engine: One-Button GameJam (Part Two)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>Rust and Bevy Engine: One-Button GameJam (Part Two)</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1674691200" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jan 26, 2023 </em> </span> <span> Updated <em class="" data-ts="1684480346" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > May 19, 2023 </em> </span><div class="mt-3 mb-3"> <a href="/assets/img/post/one-button-jam-header.png" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/img/post/one-button-jam-header.png" alt="Screenshot of the final game. Not that pretty, but not bad for two weeks of work!" width="1200" height="630" class="lazyload" data-proofer-ignore></a><figcaption class="text-center pt-2 pb-2">Screenshot of the final game. Not that pretty, but not bad for two weeks of work!</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://brooke.sh">Brooke Rhodes</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="935 words" > <em>5 min</em> read</span></div></div></div><div class="post-content"><p>Given that we only had two weeks to complete this game jam, our groupâ€™s concept had to be simple to execute. After exploring various ideas, we ultimately chose a minigolf-style game that used only the mouse as our one button.</p><p>Considering this is a programming blog, I will not delve into details about the game design. However, this is what the control scheme looked like:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>Mouse Movement = Pan Camera
Press Left Click = Enable Charging
Release Left Click = Release Charging
Move Y Movement = Change Charge Power
</pre></table></code></div></div><p>As you can see, this is not <em>technically</em> single-input. However, it is one-button (left click)! Technicalities ðŸ˜Œ</p><h1 id="implementation">Implementation</h1><p>Now, onto the fun stuff! As mentioned above, this game was implemented with Bevy and the Rust programming language. In this blog post, I will cover the high-level system design decisions and how they could have been implemented differently.</p><h2 id="commands"><span class="me-2">Commands</span><a href="#commands" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>At the core of this game are <em>commands</em>. A command is generated at the start of every frame and describes the actions the player wants to take based on their input. Commands can then be queried in other systems that run later in the frame.</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="k">struct</span> <span class="n">Command</span> <span class="p">{</span>
    <span class="n">camera_zoom</span><span class="p">:</span> <span class="nb">f32</span><span class="p">,</span>
    <span class="n">mouse_delta</span><span class="p">:</span> <span class="n">Vec2</span><span class="p">,</span>

    <span class="n">charge</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">release_charge</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>

    <span class="n">toggle_camera_lock</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">}</span>

<span class="cd">/// This code is very Bevy-specific, but an Action is essentially just an input, using the Leafwing Input Manager library.</span>
<span class="cd">///</span>
<span class="cd">/// See https://github.com/Leafwing-Studios/leafwing-input-manager for more info.</span>
<span class="k">fn</span> <span class="nf">drive_command_gen</span><span class="p">(</span>
    <span class="n">action_query</span><span class="p">:</span> <span class="n">Query</span><span class="o">&lt;&amp;</span><span class="n">ActionState</span><span class="o">&lt;</span><span class="n">Action</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">With</span><span class="o">&lt;</span><span class="n">LocalPlayer</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="k">mut</span> <span class="n">command_query</span><span class="p">:</span> <span class="n">Query</span><span class="o">&lt;&amp;</span><span class="k">mut</span> <span class="n">Command</span><span class="p">,</span> <span class="n">With</span><span class="o">&lt;</span><span class="n">LocalPlayer</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">action_state</span> <span class="o">=</span> <span class="n">action_query</span><span class="nf">.single</span><span class="p">();</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">old_command</span> <span class="o">=</span> <span class="n">command_query</span><span class="nf">.single_mut</span><span class="p">();</span>

    <span class="k">let</span> <span class="n">delta</span> <span class="o">=</span> <span class="k">match</span> <span class="n">action_state</span><span class="nf">.axis_pair</span><span class="p">(</span><span class="nn">Action</span><span class="p">::</span><span class="n">MouseDelta</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nn">Vec2</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">delta</span><span class="nf">.x</span><span class="p">(),</span> <span class="n">delta</span><span class="nf">.y</span><span class="p">()),</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nn">Vec2</span><span class="p">::</span><span class="n">ZERO</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="c1">// Update the old command to match new data</span>
    <span class="n">old_command</span><span class="py">.camera_zoom</span> <span class="o">=</span> <span class="n">action_state</span><span class="nf">.clamped_value</span><span class="p">(</span><span class="nn">Action</span><span class="p">::</span><span class="n">CameraZoom</span><span class="p">);</span>
    <span class="n">old_command</span><span class="py">.mouse_delta</span> <span class="o">=</span> <span class="n">delta</span><span class="p">;</span>

    <span class="n">old_command</span><span class="py">.charge</span> <span class="o">=</span> <span class="n">action_state</span><span class="nf">.pressed</span><span class="p">(</span><span class="nn">Action</span><span class="p">::</span><span class="n">Charge</span><span class="p">);</span>
    <span class="n">old_command</span><span class="py">.toggle_camera_lock</span> <span class="o">=</span> <span class="n">action_state</span><span class="nf">.pressed</span><span class="p">(</span><span class="nn">Action</span><span class="p">::</span><span class="n">ToggleCameraLock</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>It is not easy to improve upon this system. Commands decouple gameplay systems from processing raw player input and provide an appropriate level of abstraction for player actions. The advantage of this decoupling is that gameplay systems are unaffected if input mappings change (which they probably will!). Processing keycodes and other input methods is done in one function, making later maintenance significantly more manageable.</p><h2 id="camera-controller"><span class="me-2">Camera Controller</span><a href="#camera-controller" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Another core component of any game is its camera controller, and our little golf game is no different! Given our short timeframe for this jam, I opted to use an open-source camera manipulation library called <a href="https://github.com/h3r2tic/dolly"><code class="language-plaintext highlighter-rouge">Dolly</code></a>, which abstracts away much of the math and quaternion logic that comes with handling cameras.</p><p>The camera system builds off of commands, utilising <code class="language-plaintext highlighter-rouge">mouse_delta</code> to drive camera rotation around the golf ball. In addition, it uses the command structs <code class="language-plaintext highlighter-rouge">camera_zoom</code> to drive the zoom in/out logic.</p><p>Zooming the camera in and out took much tuning to get right. In addition to adjusting the cameraâ€™s distance to the golf ball, the cameraâ€™s vertical <em>height</em> is also adjusted based on how far the camera is zoomed out. This effect is implemented with various easings, allowing players to view their surroundings more intuitively.</p><video src="/assets/video/one-button-jam-camera-demo.mp4" controls="" style="max-width: 100%"></video><p><a href="/assets/video/one-button-jam-camera-demo.mp4" class="popup img-link "><img data-src="/assets/video/one-button-jam-camera-demo.mp4" alt="" class="lazyload" data-proofer-ignore></a> <em>Camera controller demonstration, showcasing panning and zooming in/out behavior</em></p><p>Thanks to the use of Dolly, the camera implementation remained relatively straightforward. With some of the query boilerplate omitted, this is what the camera system looks like:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre><td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">drive_camera</span><span class="p">(</span>
    <span class="n">q0</span><span class="p">:</span> <span class="n">Query</span><span class="o">&lt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">GlobalTransform</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">LocalCharacter</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">q1</span><span class="p">:</span> <span class="n">Query</span><span class="o">&lt;&amp;</span><span class="n">Command</span><span class="p">,</span> <span class="n">With</span><span class="o">&lt;</span><span class="n">LocalPlayer</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="k">mut</span> <span class="n">q2</span><span class="p">:</span> <span class="n">Query</span><span class="o">&lt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">Rig</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">CameraState</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="k">mut</span> <span class="n">q3</span><span class="p">:</span> <span class="n">Query</span><span class="o">&lt;&amp;</span><span class="k">mut</span> <span class="n">Projection</span><span class="p">,</span> <span class="n">With</span><span class="o">&lt;</span><span class="n">CurrentCamera</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="k">mut</span> <span class="n">windows</span><span class="p">:</span> <span class="n">ResMut</span><span class="o">&lt;</span><span class="n">Windows</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nf">Ok</span><span class="p">((</span><span class="n">ball_transform</span><span class="p">,</span> <span class="n">character</span><span class="p">))</span> <span class="o">=</span> <span class="n">q0</span><span class="nf">.get_single</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">command</span> <span class="o">=</span> <span class="n">q1</span><span class="nf">.single</span><span class="p">();</span> <span class="c1">// SAFETY: Commands will always be generating if we have a character</span>
        <span class="k">let</span> <span class="p">(</span><span class="k">mut</span> <span class="n">rig</span><span class="p">,</span> <span class="k">mut</span> <span class="n">camera_state</span><span class="p">)</span> <span class="o">=</span> <span class="n">q2</span><span class="nf">.single_mut</span><span class="p">();</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">projection</span> <span class="o">=</span> <span class="n">q3</span><span class="nf">.single_mut</span><span class="p">();</span>

        <span class="c1">// Set the camera position to the golf ball's position</span>
        <span class="k">let</span> <span class="n">ball_translation</span> <span class="o">=</span> <span class="n">ball_transform</span><span class="nf">.translation</span><span class="p">();</span>
        <span class="n">rig</span><span class="py">.driver_mut</span><span class="p">::</span><span class="o">&lt;</span><span class="n">Position</span><span class="o">&gt;</span><span class="p">()</span><span class="py">.position</span> <span class="o">=</span> <span class="n">ball_translation</span> <span class="o">+</span> <span class="p">(</span><span class="nn">Vec3</span><span class="p">::</span><span class="n">Y</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">);</span>

        <span class="c1">// Zoom the camera in and out</span>
        <span class="k">let</span> <span class="n">new_zoom</span> <span class="o">=</span>
            <span class="p">(</span><span class="n">camera_state</span><span class="py">.zoom</span> <span class="o">-</span> <span class="p">(</span><span class="n">command</span><span class="py">.camera_zoom</span> <span class="o">*</span> <span class="n">CAMERA_ZOOM_SENSITIVITY</span><span class="p">))</span><span class="nf">.clamp</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>

        <span class="c1">// Persist the zoom in the state for future frames to access</span>
        <span class="n">camera_state</span><span class="py">.zoom</span> <span class="o">=</span> <span class="n">new_zoom</span><span class="p">;</span>

        <span class="c1">// Ease the horizontal offset along a curve, mapping the 0-1 value to the min and max horizontal offsets</span>
        <span class="k">let</span> <span class="n">horizontal_offset</span> <span class="o">=</span> <span class="nf">map_01</span><span class="p">(</span>
            <span class="nf">ease_out_quad</span><span class="p">(</span><span class="n">new_zoom</span><span class="p">),</span>
            <span class="n">MIN_CAMERA_Z_OFFSET</span><span class="p">,</span>
            <span class="n">MAX_CAMERA_Z_OFFSET</span><span class="p">,</span>
        <span class="p">);</span>

        <span class="c1">// Ease the vertical offset along a curve, mapping the 0-1 value to the min and max vertical offsets</span>
        <span class="k">let</span> <span class="n">vertical_offset</span> <span class="o">=</span> <span class="nf">map_01</span><span class="p">(</span>
            <span class="nf">ease_in_out_cubic</span><span class="p">(</span><span class="n">new_zoom</span><span class="p">),</span>
            <span class="n">MIN_CAMERA_Y_OFFSET</span><span class="p">,</span>
            <span class="n">MAX_CAMERA_Y_OFFSET</span><span class="p">,</span>
        <span class="p">);</span>

        <span class="c1">// Apply the offsets</span>
        <span class="k">let</span> <span class="n">arm</span> <span class="o">=</span> <span class="n">rig</span><span class="py">.driver_mut</span><span class="p">::</span><span class="o">&lt;</span><span class="n">Arm</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="n">arm</span><span class="py">.offset</span> <span class="o">=</span> <span class="nn">Vec3</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">vertical_offset</span><span class="p">,</span> <span class="n">horizontal_offset</span><span class="p">);</span>

        <span class="c1">// Update the FOV of the camera, based on whether or not it is moving</span>
        <span class="c1">// TODO: Add easing to camera FOV</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nn">Projection</span><span class="p">::</span><span class="nf">Perspective</span><span class="p">(</span><span class="n">projection</span><span class="p">)</span> <span class="o">=</span> <span class="n">projection</span><span class="nf">.deref_mut</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">projection</span><span class="py">.fov</span> <span class="o">=</span> <span class="k">if</span> <span class="n">character</span><span class="py">.should_allow_control</span> <span class="p">{</span>
                <span class="n">CAMERA_FOV_STILL</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">CAMERA_FOV_MOVING</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Rotate the camera around the golf ball based on mouse delta</span>
        <span class="k">if</span> <span class="o">!</span><span class="n">command</span><span class="py">.charge</span> <span class="o">&amp;&amp;</span> <span class="n">camera_state</span><span class="py">.camera_locked</span> <span class="p">{</span>
            <span class="n">rig</span><span class="py">.driver_mut</span><span class="p">::</span><span class="o">&lt;</span><span class="n">YawPitch</span><span class="o">&gt;</span><span class="p">()</span><span class="nf">.rotate_yaw_pitch</span><span class="p">(</span>
                <span class="o">-</span><span class="n">CAMERA_MOVE_SENSITIVITY</span> <span class="o">*</span> <span class="n">command</span><span class="py">.mouse_delta.x</span><span class="p">,</span>
                <span class="o">-</span><span class="n">CAMERA_MOVE_SENSITIVITY</span> <span class="o">*</span> <span class="n">command</span><span class="py">.mouse_delta.y</span><span class="p">,</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// A debug key can pressed to give mouse control back</span>
        <span class="k">if</span> <span class="n">command</span><span class="py">.toggle_camera_lock</span> <span class="p">{</span>
            <span class="n">camera_state</span><span class="py">.camera_locked</span> <span class="o">=</span> <span class="o">!</span><span class="n">camera_state</span><span class="py">.camera_locked</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">window</span> <span class="k">in</span> <span class="n">windows</span><span class="nf">.iter_mut</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">window</span><span class="nf">.set_cursor_lock_mode</span><span class="p">(</span><span class="n">camera_state</span><span class="py">.camera_locked</span><span class="p">);</span>
                <span class="n">window</span><span class="nf">.set_cursor_visibility</span><span class="p">(</span><span class="o">!</span><span class="n">camera_state</span><span class="py">.camera_locked</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>   
</pre></table></code></div></div><h1 id="part-three">Part Three</h1><p>The final part of this mini-series, Part Three, will cover the physics and ball controller implementations. Weâ€™ll explore how it was implemented and how it could be improved.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/university/'>University</a>, <a href='/categories/devblog/'>Devblog</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/university/" class="post-tag no-text-decoration" >university</a> <a href="/tags/gamejam/" class="post-tag no-text-decoration" >gamejam</a> <a href="/tags/rust/" class="post-tag no-text-decoration" >rust</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Rust%20and%20Bevy%20Engine:%20One-Button%20GameJam%20(Part%20Two)%20-%20Brooke%20Rhodes&url=https%3A%2F%2Fbrooke.fyi%2Fposts%2Fone-button-jam-2%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Rust%20and%20Bevy%20Engine:%20One-Button%20GameJam%20(Part%20Two)%20-%20Brooke%20Rhodes&u=https%3A%2F%2Fbrooke.fyi%2Fposts%2Fone-button-jam-2%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fbrooke.fyi%2Fposts%2Fone-button-jam-2%2F&text=Rust%20and%20Bevy%20Engine:%20One-Button%20GameJam%20(Part%20Two)%20-%20Brooke%20Rhodes" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram" > <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content ps-0 pb-1 ms-1 mt-2"><li> <a href="/posts/one-button-jam-1/">Rust and Bevy Engine: One-Button GameJam (Part One)</a><li> <a href="/posts/one-button-jam-2/">Rust and Bevy Engine: One-Button GameJam (Part Two)</a><li> <a href="/posts/one-button-jam-3/">Rust and Bevy Engine: One-Button GameJam (Part Three)</a><li> <a href="/posts/unity-springs/">Springs for Animation in Unity</a><li> <a href="/posts/playfab-sdk-v3/">PlayFab SDK V3</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/university/">university</a> <a class="post-tag btn btn-outline-primary" href="/tags/gamejam/">gamejam</a> <a class="post-tag btn btn-outline-primary" href="/tags/rust/">rust</a> <a class="post-tag btn btn-outline-primary" href="/tags/c/">c++</a> <a class="post-tag btn btn-outline-primary" href="/tags/unreal-engine/">unreal engine</a> <a class="post-tag btn btn-outline-primary" href="/tags/c/">c#</a> <a class="post-tag btn btn-outline-primary" href="/tags/devlog/">devlog</a> <a class="post-tag btn btn-outline-primary" href="/tags/library/">library</a> <a class="post-tag btn btn-outline-primary" href="/tags/luau/">luau</a> <a class="post-tag btn btn-outline-primary" href="/tags/roblox/">roblox</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/one-button-jam-1/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1674172800" data-df="ll" > Jan 20, 2023 </em><h4 class="pt-0 my-2" data-toc-skip>Rust and Bevy Engine: One-Button GameJam (Part One)</h4><div class="text-muted small"><p> A few months ago, I completed my first university game jam. Everybody was in teams of two to three, and the only rule was that the game could only use one button. Simple enough! While there was on...</p></div></div></a></div><div class="col"> <a href="/posts/one-button-jam-3/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1676332800" data-df="ll" > Feb 14, 2023 </em><h4 class="pt-0 my-2" data-toc-skip>Rust and Bevy Engine: One-Button GameJam (Part Three)</h4><div class="text-muted small"><p> This is the final entry for my One-Button GameJam series of blog posts, and weâ€™ll be covering the gameâ€™s core mechanic - golf balls! Everything from physics to sound. Physics If I were to remake ...</p></div></div></a></div><div class="col"> <a href="/posts/unity-springs/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1679616000" data-df="ll" > Mar 24, 2023 </em><h4 class="pt-0 my-2" data-toc-skip>Springs for Animation in Unity</h4><div class="text-muted small"><p> I come from a Roblox and web background, where Springs see widespread use in all facets of animation. However, this tool seems somewhat less recognized outside of these spaces, especially in the br...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/one-button-jam-1/" class="btn btn-outline-primary" prompt="Older" ><p>Rust and Bevy Engine: One-Button GameJam (Part One)</p></a> <a href="/posts/one-button-jam-3/" class="btn btn-outline-primary" prompt="Newer" ><p>Rust and Bevy Engine: One-Button GameJam (Part Three)</p></a></div><script type="text/javascript"> (function () { const origin = 'https://giscus.app'; const iframe = 'iframe.giscus-frame'; const lightTheme = 'light'; const darkTheme = 'dark_dimmed'; let initTheme = lightTheme; const html = document.documentElement; if ( (html.hasAttribute('data-mode') && html.getAttribute('data-mode') === 'dark') || (!html.hasAttribute('data-mode') && window.matchMedia('(prefers-color-scheme: dark)').matches) ) { initTheme = darkTheme; } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'grilme99/grilme99.github.io', 'data-repo-id': 'R_kgDOHdYWRg', 'data-category': 'General', 'data-category-id': 'DIC_kwDOHdYWRs4CR34D', 'data-mapping': 'pathname', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'top', 'data-lang': 'en', crossorigin: 'anonymous', async: '' }; let giscusScript = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value) ); document.getElementById('tail-wrapper').appendChild(giscusScript); addEventListener('message', (event) => { if ( event.source === window && event.data && event.data.direction === ModeToggle.ID ) { /* global theme mode changed */ const mode = event.data.message; const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme; const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); })(); </script></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/university/">university</a> <a class="post-tag btn btn-outline-primary" href="/tags/gamejam/">gamejam</a> <a class="post-tag btn btn-outline-primary" href="/tags/rust/">rust</a> <a class="post-tag btn btn-outline-primary" href="/tags/c/">c++</a> <a class="post-tag btn btn-outline-primary" href="/tags/unreal-engine/">unreal engine</a> <a class="post-tag btn btn-outline-primary" href="/tags/c/">c#</a> <a class="post-tag btn btn-outline-primary" href="/tags/devlog/">devlog</a> <a class="post-tag btn btn-outline-primary" href="/tags/library/">library</a> <a class="post-tag btn btn-outline-primary" href="/tags/luau/">luau</a> <a class="post-tag btn btn-outline-primary" href="/tags/roblox/">roblox</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p><p>Â© 2023 <a href="https://brooke.sh">Brooke Rhodes</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/unregister.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-X2BTMY1TLL"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-X2BTMY1TLL'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
